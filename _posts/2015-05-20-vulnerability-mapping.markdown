---
layout: post
title: "Predicting 911 Call Locations using Poisson Point Processes"
author: Jacob Mortensen
date: 2015-05-20
category: statistics
image: /assets/article\_images/vulnerability-mapping/houston.png
tags: [poisson-point-processes, vulnerability-mapping]
---

### Heat in Houston

In many locations throughout the world extreme heat represents a significant health hazard.
Heat is linked directly to illnesses like hyperthermia and heat exhaustion, but can also
exacerbate other negative health outcomes such as cardiovascular failure or kidney disease.
In the United States, an average of [618 deaths per year are attributed to heat][1]. Officials
in the city of Houston, TX, are interested in understanding what areas of the city are most 
vulnerable to extreme heat because it will help them to identify potential interventions
that will lead to increased health for Houston residents.

In order to understand the relationship between heat and health, it is necessary to make use of
spatial data. Spatial data presents unique challenges for analysis. It tends to be highly correlated 
and nonlinear, making traditional methods, such as multiple linear regression, difficult or 
impossible to implement. One method that can be used to effectively model this type of data,
dealing with both nonlinearity and correlation in a graceful manner, is a stochastic point 
process model.

### What is a stochastic point process?

The word "stochastic" simply means random, so a [stochastic process][2] is just a collection
of random variables. These random variables can be from any family, so a Gaussian process
is a collection of normal random variables, a Poisson process is a collection of Poisson 
random variables, and so on. Stochastic processes can be used to describe data that is 
distributed throughout time or space and generally assume that points closer to one another are more highly correlated.
By assuming that points behave similarly to nearby locations we can make predictions about 
values in unobserved locations.
In this post I will demonstrate how a Poisson process can be used to predict the likelihood that
a heat-related 911 call comes from a specific area in the city of Houston. 

### 911 call data

Our data consists of 1389 heat-related 911 calls made over a 4 year period between 2006 and 2010. A 
heat-related 911 call is defined as one where an emergency responder diagnosed the victim 
with a heat-related illness, such as hyperthermia or heat exhaustion. We are interested in 
understanding both the number of phone calls we expect to receive and where they are coming from. 
Fortunately a Poisson point process can allow us to answer both of these questions at the same time.

### Model

To model this data we need to consider two pieces: the total number of phone calls and the location 
where each phone call originated. Let \\(N\\) be the number of phone calls and assume that 
\\[N \sim \text{Poisson}\left(\int\_{\mathcal{S}}\Lambda(s)\right),\\] where \\(\mathcal{S}\\) is the set of all 
spatial locations in the city of Houston and \\(\Lambda(s)\\) is what is known as the _intensity function_.
Then let the joint probability that a phone call came from a specific location be 
\\[f(s\_1,s\_2,\dots,s\_N|N) = \prod\_{i=1}^N\frac{\Lambda(s\_i)}{\int\_{\mathcal{S}}\Lambda(s)},\\]
where \\(s\_1,s\_2,\dots,s\_N\\) are the latitude-longitude coordinates of the 
observed 911 calls. The intensity function is present in both the function for the number of phone calls and in the 
function for spatial location, which begs the question, "what _is_ the intensity function?"

First note that since \\(N \sim \text{Poisson}\left(\int\_{\mathcal{S}}\Lambda(s)\right)\\) it follows that
the mean number of calls is given by integrating the intensity function over all spatial locations. Second,
note that when we normalize \\(\Lambda(s)\\) it gives us the density for a phone call originating
from a particular spatial location. The intensity function is crucial because it allows us
to simultaneously model both the expected number of phone calls and where they are expected to come from.
In order to understand the distribution of heat-related 911 calls, we need to be able to estimate
\\(\Lambda(s)\\).

In order to produce this estimate we use the full likelihood, which can be shown to be
\\[ L(\Lambda(s)) \propto \exp\left(-\int\_{\mathcal{S}}\Lambda(s)\right)\prod\_{i=1}^N\Lambda(s\_i) \\]
However, one problem that immediately becomes apparent is how to estimate the intensity function. 
Estimating \\(\Lambda(s)\\) requires integrating \\(\Lambda(s)\\) over every latitude-longitude coordinate 
within the Houston area, which requires an estimate of \\(\Lambda(s)\\), which requires integrating \\(\Lambda(s)\\)
, ... and so it is clear that this quickly becomes intractable (or at the very least unpleasant) to estimate as is.

Fortunately we can simplify this problem considerably by treating \\(\mathcal{S}\\) as a discrete surface
and by reparameterizing \\(\Lambda(s)\\). Instead of considering \\(\mathcal{S}\\) as a continuous surface,
treat it as a grid with the \\(i\text{th}\\) grid cell centered at \\(s\_i^{\*}\\), where
\\(s\_1^{\*}, s\_2^{\*}, \dots s\_K^{\*}\\) are the latitude-longitude coordinates for each prediction
location and  where \\(K=1428\\). With this reparameterization it is possible to write 
\\[ \Lambda(s) = \delta \sum\_{k=1}^K \frac{\lambda\_k}{|\mathcal{G}\_k|}\mathbf{1}\left(s \in \mathcal{G}\_k\right) \\]
where \\(\mathcal{G}\_k\\) is the \\(k\\)th grid cell, \\(\lambda\_k \\in (0,1)\\) and \\(\lambda\_k\\) is constrained 
so that  \\(\sum\_{k=1}^K \lambda\_k = 1\\). This parameterization is convenient because it has a very simple interpretation:
\\(\delta\\) represents the number of phone calls received and now that our domain is discrete, 
\\(\lambda\_k\\) represents the probability that a phone call
originates within a particular grid cell. The following graphic can help us understand how this function is behaving. The black
dots represent the center of each grid cell, the \\(s\_1^{\*}, s\_2^{\*}, \dots\\) defined above, making each box the grid cell
centered at \\(s\_i^{\*}\\). When a 911 call comes in (the red dot) then it is assigned the probability of that entire grid cell. 

<div class="w70 center">
<figure>
  <img src="/assets/article_images/vulnerability-mapping/grid_spot_highlighted.png">
<figcaption>When a 911 call occurs in a grid cell, it is assigned the same probability as any other 911 call that falls within that grid cell.</figcaption>
</figure>
</div>

With this reparameterization, the likelihood can be written

 \begin{align} L(\Lambda(s)) &= \exp(-\delta)\delta^N \prod\_{i=1}^N\frac{\lambda\_{(k:s\_i \in \mathcal{G}\_k)}}{|\mathcal{G}\_k|} \\\\
  &= \exp(-\delta)\delta^N\prod\_{i=1}^K \frac{\lambda\_k^{N\_k}}{|\mathcal{G}\_k|} \end{align} 

### Fitting the model

With this significantly simplified likelihood we now need to define our prior distributions for 
\\(\delta\\) and \\(\lambda\_k\\). For \\(\delta\\) use a gamma(0.001, 0.001) prior, which we use 
because it is conjugate, making drawing from the posterior very simple, and because it is fairly 
uninformative. Choosing a prior for \\(\lambda\\) is a bit more difficult. We want to take advantage of the 
spatial smoothness present in the data, which suggests that a Gaussian process is appropriate. 
To do this let \\[ \lambda\_k \propto \exp(\lambda\_k^{\*}) \\] with \\[\boldsymbol{\lambda}^{\*} 
= \left( \begin{array}{c} \lambda\_1^{\*} \\\\ \lambda\_2^{\*} \\\\ \vdots \\\\ \lambda\_k^{\*} 
\end{array} \right) \sim \mathcal{N}(\mathbf{0}, \sigma^2\mathbf{M}\_{\nu}(D|\phi)) \\] where
\\(\mathbf{M}\_{\nu}(D|\phi)\\) is the matrix produced by the [Mat√©rn covariance function][3] with smoothness
parameter \\(\nu\\) and decay parameter \\(\phi\\) and where \\(D\\) represents the distance between 
the \\(K\\) prediction locations. It then follows that 
\\[ \lambda\_k = \frac{\exp(\lambda^{\*}\_k)}{\sum\_{j=1}^K\exp(\lambda^{\*}\_j)}. \\]

Now we are able to use a Gaussian process prior to calculate the posterior density for 
\\(\boldsymbol{\lambda}^{\*}\\) which we can easily transform to get estimates for \\(\boldsymbol{\lambda} \\).
With this prior, our posterior density is
\\[\pi(\boldsymbol{\lambda}^{\*})L(\boldsymbol{\lambda}^{\*}|N) 
\propto \exp\left(-\frac{1}{2\sigma^2}(\boldsymbol{\lambda}^{\*})^{'}\mathbf{M}\_{\nu}(D|\phi)^{-1}(\boldsymbol{\lambda}^{\*})\right)
\prod\_{k=1}^{K}\left(\frac{\exp(\lambda\_k^{\*})}{\sum\_{j=1}^K\exp(\lambda\_j^{\*})}\right)^{N\_k} \\]

Using a Metropolis within Gibbs sampler and a burn-in of 10,000 draws, we are able to generate 100,000 draws from
the posterior distributions of \\(\delta\\) and \\(\boldsymbol{\lambda}^{\*}\\).

### Results

The posterior mean for \\(\delta\\) is 1387.65, with a 95% confidence interval of (1317.10, 1461.01), which means that 
over a given 4 year period, we would expect to see anywhere from 1317 to 1461 heat-related 911 calls. The map
below shows the probabilities that a 911 call originates from within a particular grid cell, with darker values
representing higher probabilities.

<figure>
<iframe width='100%' height='500px' frameBorder='0'
src='https://a.tiles.mapbox.com/v4/jwmortensen.m36nngic/attribution,zoompan,zoomwheel,geocoder,share.html?access_token=pk.eyJ1Ijoiandtb3J0ZW5zZW4iLCJhIjoiQjJHSVp4NCJ9.AYH98hv0ksUCLvwmsJHfeQ'></iframe>
<figcaption>This map shows the predicted probability that a 911 call originates in a 1 km grid cell.</figcaption>
</figure>

### Conclusions

Using a Poisson point process model we were able to successfully model the number of heat-related 911 calls and
where we would expect them to come from. By looking at the map, we are able to see that there is a higher degree
of vulnerability in the downtown area, where there are many parks and more opportunities to walk around outside. 
This will allow city officials to understand how heat affects city residents which will in turn allow them to 
understand what and where interventions will be most effective. 

For more information about spatial point process models, check out the excellent [*Statistics for Spatio-Temporal Data*
by Cressie and Wikle][4].

[1]: http://www.cdc.gov/mmwr/preview/mmwrhtml/mm6136a6.htm "CDC"
[2]: http://en.wikipedia.org/wiki/Stochastic_process "Stochastic Processes"
[3]: http://en.wikipedia.org/wiki/Mat%C3%A9rn_covariance_function "Wikipedia entry for Matern Covariance Function"
[4]: http://www.amazon.com/Statistics-Spatio-Temporal-Data-Noel-Cressie/dp/0471692743 "Amazon page for Statistics for Spatio-Temporal Data"
